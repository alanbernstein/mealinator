<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bernstein Recipes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="site-header">
        <h1>Bernstein Recipes</h1>
        <p class="site-subtitle">Showing {{ recipe_count }} recipes</p>
        <p class="site-attribution">Database exported: {{ db_exported }} | Rendered: {{ now }}</p>
    </header>

    <div class="controls-container">
        <div class="filter-controls">
            <label>Filter by tag:</label>
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">All</button>
                {% for tag in all_tags %}
                <button class="filter-btn" data-filter="{{ tag }}">{{ tag }}</button>
                {% endfor %}
            </div>
        </div>

        <div class="sort-controls">
            <label for="sort-select">Sort by:</label>
            <select id="sort-select" class="sort-select">
                <option value="order">Default Order</option>
                <option value="alphabetical">Alphabetical (A-Z)</option>
                <option value="alphabetical-reverse">Alphabetical (Z-A)</option>
            </select>
        </div>
    </div>

    <main class="recipe-grid" id="recipe-grid">
        {% for recipe in recipes %}
        <a href="html/{{ recipe.filename }}.html" class="recipe-card" data-tags="{{ recipe.tags_str }}" data-order="{{ loop.index0 }}" data-title="{{ recipe.title }}">
            <div class="recipe-card-image">
                <img src="images/thumbnails/{{ recipe.filename }}.jpg" alt="{{ recipe.title }}" loading="lazy" onerror="this.onerror=null; this.src='images/placeholder.jpg'">
            </div>
            <div class="recipe-card-content">
                <h2 class="recipe-card-title">{{ recipe.title }}</h2>
            </div>
        </a>
        {% endfor %}
    </main>

    <script>
        // Progressive enhancement - only if JavaScript is available
        (function() {
            var currentFilter = 'all';
            var currentSort = 'order';
            var allCards = document.querySelectorAll('.recipe-card');
            var grid = document.getElementById('recipe-grid');
            var subtitle = document.querySelector('.site-subtitle');

            // Filter and sort recipes using existing DOM elements
            function displayRecipes() {
                var cardsArray = Array.prototype.slice.call(allCards);
                var visible = [];

                // Filter
                cardsArray.forEach(function(card) {
                    var tags = card.getAttribute('data-tags') || '';
                    var shouldShow = currentFilter === 'all' || tags.indexOf(currentFilter) !== -1;

                    if (shouldShow) {
                        card.style.display = '';
                        visible.push(card);
                    } else {
                        card.style.display = 'none';
                    }
                });

                // Sort visible cards
                if (currentSort === 'alphabetical') {
                    visible.sort(function(a, b) {
                        var titleA = a.getAttribute('data-title') || '';
                        var titleB = b.getAttribute('data-title') || '';
                        return titleA.localeCompare(titleB);
                    });
                } else if (currentSort === 'alphabetical-reverse') {
                    visible.sort(function(a, b) {
                        var titleA = a.getAttribute('data-title') || '';
                        var titleB = b.getAttribute('data-title') || '';
                        return titleB.localeCompare(titleA);
                    });
                } else {
                    visible.sort(function(a, b) {
                        var orderA = parseInt(a.getAttribute('data-order')) || 0;
                        var orderB = parseInt(b.getAttribute('data-order')) || 0;
                        return orderA - orderB;
                    });
                }

                // Re-append in sorted order
                visible.forEach(function(card) {
                    grid.appendChild(card);
                });

                // Update count
                subtitle.textContent = 'Showing ' + visible.length + ' of ' + allCards.length + ' recipes';
            }

            // Filter button clicks
            var filterButtons = document.querySelectorAll('.filter-btn');
            for (var i = 0; i < filterButtons.length; i++) {
                filterButtons[i].addEventListener('click', function() {
                    for (var j = 0; j < filterButtons.length; j++) {
                        filterButtons[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    currentFilter = this.getAttribute('data-filter');
                    displayRecipes();
                });
            }

            // Sort select change
            var sortSelect = document.getElementById('sort-select');
            sortSelect.addEventListener('change', function() {
                currentSort = this.value;
                displayRecipes();
            });

            // Initial display (just update counter, cards already rendered)
            displayRecipes();
        })();
    </script>
</body>
</html>
